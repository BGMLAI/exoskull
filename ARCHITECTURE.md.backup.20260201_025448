# EXOSKULL - Adaptive Life Operating System
## Self-Optimizing Multi-Tenant Architecture

**Mission:** Fill gaps in life for people who struggle. Adapt. Optimize. Evolve.

**Version:** 1.0
**Created:** 2026-01-31
**Status:** Design Phase

---

## CORE PRINCIPLES

### 1. Self-Optimization
The system **learns and improves its own structure** based on:
- What works for each user (pattern learning)
- Which agents are most useful (usage analytics)
- Which workflows succeed (outcome tracking)
- User feedback (explicit + implicit signals)

### 2. Adaptive Architecture
Not one-size-fits-all. Each user gets:
- Personalized agent ecosystem
- Custom workflows based on their needs
- Dynamic priority system
- Tailored notifications

### 3. Multi-Tenant SaaS
Built from day 1 for multiple users:
- Row-level security (RLS)
- Per-user data isolation
- Tiered pricing model
- White-label ready

### 4. Gap Detection & Filling
The system identifies where users struggle:
- Missing structure → creates routines
- Poor organization → automates capture
- Lack of follow-through → accountability agents
- Financial chaos → cashflow tracking
- Health neglect → proactive reminders

---

## ARCHITECTURE LAYERS

```
┌─────────────────────────────────────────────────┐
│  VOICE INTERFACE (VAPI + Azure TTS)            │
│  "Primary input method - typing is backup"     │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│  INTENT ROUTER (Claude API)                    │
│  "What does the user need right now?"          │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│  AGENT ORCHESTRATOR (Self-optimizing)          │
│  "Which agents should handle this?"            │
│  • Load balancing                              │
│  • Agent selection based on past performance   │
│  • Dynamic agent creation for new patterns     │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│  AGENT ECOSYSTEM (Modular + Extensible)        │
│  • Core agents (everyone gets these)          │
│  • Specialized agents (user-specific)         │
│  • Learning agents (improve over time)        │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│  EXECUTION LAYER (Supabase + Integrations)     │
│  • Database operations                         │
│  • API calls (Google, GHL, etc.)              │
│  • File operations                             │
│  • Notifications                               │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│  LEARNING LAYER (Pattern Recognition + ML)     │
│  • What worked?                                │
│  • What failed?                                │
│  • How to optimize?                            │
│  • Update agent weights                        │
└─────────────────────────────────────────────────┘
```

---

## MULTI-TENANT DATABASE SCHEMA

### Core Tables

```sql
-- TENANTS (Organizations/Users)
tenants (
  id uuid PRIMARY KEY,
  name text,
  email text UNIQUE,
  phone text,
  timezone text DEFAULT 'Europe/Warsaw',
  language text DEFAULT 'pl',
  subscription_tier text, -- free, basic, pro, enterprise
  subscription_status text, -- trial, active, cancelled, expired
  trial_ends_at timestamp,
  settings jsonb, -- user preferences
  adhd_settings jsonb, -- ADHD-specific config
  created_at timestamp,
  updated_at timestamp
)

-- Enable RLS
ALTER TABLE tenants ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can only see their own tenant"
  ON tenants FOR ALL
  USING (auth.uid() = id);

-- PROJECTS (User's work/life areas)
projects (
  id uuid PRIMARY KEY,
  tenant_id uuid REFERENCES tenants(id) ON DELETE CASCADE,
  name text,
  description text,
  category text, -- work, personal, health, finance, legal, creative
  tier integer, -- 1=critical, 2=important, 3=nice-to-have
  status text, -- active, paused, blocked, completed, archived
  completion_percentage integer DEFAULT 0,
  health_score integer, -- 0-100 (calculated by system)
  next_action text,
  blockers jsonb, -- [{ type, description, created_at }]
  deadline timestamp,
  assigned_agents uuid[], -- array of agent IDs
  external_integrations jsonb, -- { gdrive_folder_id, github_repo, etc. }
  metrics jsonb, -- project-specific KPIs
  created_at timestamp,
  updated_at timestamp
)

ALTER TABLE projects ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can only see their own projects"
  ON projects FOR ALL
  USING (tenant_id = auth.uid());

-- AGENTS (AI Personalities)
agents (
  id uuid PRIMARY KEY,
  name text, -- "COO Executive", "ADHD Coach", "Finansista"
  type text, -- core, specialized, learning
  tier integer, -- 1-4 (priority)
  description text,
  system_prompt text,
  personality_config jsonb,
  capabilities text[], -- array of capabilities
  is_global boolean DEFAULT false, -- available to all users?
  created_by uuid REFERENCES tenants(id), -- NULL if system-created
  active boolean DEFAULT true,
  performance_metrics jsonb, -- success rate, avg response time, user satisfaction
  created_at timestamp,
  updated_at timestamp
)

-- Global agents are visible to all, user-created agents only to creator
ALTER TABLE agents ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can see global agents and their own"
  ON agents FOR SELECT
  USING (is_global = true OR created_by = auth.uid());

-- TENANT_AGENTS (Which agents are enabled for which tenant)
tenant_agents (
  id uuid PRIMARY KEY,
  tenant_id uuid REFERENCES tenants(id) ON DELETE CASCADE,
  agent_id uuid REFERENCES agents(id) ON DELETE CASCADE,
  enabled boolean DEFAULT true,
  custom_config jsonb, -- tenant-specific overrides
  performance_weight decimal DEFAULT 1.0, -- how well this agent works for this user
  last_used_at timestamp,
  usage_count integer DEFAULT 0,
  success_count integer DEFAULT 0,
  created_at timestamp,
  UNIQUE(tenant_id, agent_id)
)

ALTER TABLE tenant_agents ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can only see their own agent assignments"
  ON tenant_agents FOR ALL
  USING (tenant_id = auth.uid());

-- AGENT_MEMORY (Per-tenant agent knowledge)
agent_memory (
  id uuid PRIMARY KEY,
  tenant_id uuid REFERENCES tenants(id) ON DELETE CASCADE,
  agent_id uuid REFERENCES agents(id) ON DELETE CASCADE,
  memory_type text, -- fact, preference, pattern, decision, learned_behavior
  content text,
  embedding vector(1536), -- pgvector for semantic search
  importance integer, -- 1-10
  confidence decimal, -- 0.0-1.0 (how sure is the agent?)
  source text, -- 'conversation', 'observation', 'feedback', 'inferred'
  verified boolean DEFAULT false, -- user confirmed?
  created_at timestamp,
  expires_at timestamp, -- NULL = permanent
  accessed_count integer DEFAULT 0,
  last_accessed_at timestamp
)

ALTER TABLE agent_memory ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can only see their own agent memories"
  ON agent_memory FOR ALL
  USING (tenant_id = auth.uid());

-- TASKS (Actions to take)
tasks (
  id uuid PRIMARY KEY,
  tenant_id uuid REFERENCES tenants(id) ON DELETE CASCADE,
  project_id uuid REFERENCES projects(id) ON DELETE SET NULL,
  title text,
  description text,
  status text, -- pending, in_progress, blocked, done, cancelled
  priority integer, -- 1-4 (1=critical, 4=someday)
  energy_required integer, -- 1-10 (match to user's current energy)
  time_estimate_minutes integer,
  due_date timestamp,
  assigned_agent_id uuid REFERENCES agents(id),
  created_by_agent_id uuid REFERENCES agents(id),
  parent_task_id uuid REFERENCES tasks(id), -- for subtasks
  dependencies uuid[], -- array of task IDs that must complete first
  context jsonb, -- related info, links, notes
  completed_at timestamp,
  created_at timestamp,
  updated_at timestamp
)

ALTER TABLE tasks ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can only see their own tasks"
  ON tasks FOR ALL
  USING (tenant_id = auth.uid());

-- CONVERSATIONS (Voice + text interactions)
conversations (
  id uuid PRIMARY KEY,
  tenant_id uuid REFERENCES tenants(id) ON DELETE CASCADE,
  agent_id uuid REFERENCES agents(id),
  vapi_call_id text, -- if voice call
  channel text, -- voice, web, mobile, sms
  transcript text,
  intent text, -- what user wanted
  routing jsonb, -- which agents were involved
  actions_taken jsonb, -- what happened as result
  user_satisfaction integer, -- 1-5 stars (if provided)
  duration_seconds integer,
  cost_usd decimal,
  energy_level integer, -- user's energy at time of conversation
  created_at timestamp
)

ALTER TABLE conversations ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can only see their own conversations"
  ON conversations FOR ALL
  USING (tenant_id = auth.uid());

-- HEALTH_LOGS (Wellness tracking)
health_logs (
  id uuid PRIMARY KEY,
  tenant_id uuid REFERENCES tenants(id) ON DELETE CASCADE,
  date date,
  energy_level integer, -- 1-10 from morning checkin
  sleep_hours decimal,
  exercise_minutes integer,
  mood text, -- poor, okay, good, great
  stress_level integer, -- 1-10
  chronic_pain_level integer, -- 1-10 (if applicable, e.g., ZZSK)
  sobriety_day_count integer, -- for recovery tracking
  notes text,
  created_at timestamp,
  UNIQUE(tenant_id, date)
)

ALTER TABLE health_logs ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can only see their own health logs"
  ON health_logs FOR ALL
  USING (tenant_id = auth.uid());

-- FINANCES (Money tracking)
finances (
  id uuid PRIMARY KEY,
  tenant_id uuid REFERENCES tenants(id) ON DELETE CASCADE,
  type text, -- income, expense, investment, debt, transfer
  amount decimal,
  currency text DEFAULT 'PLN',
  category text,
  project_id uuid REFERENCES projects(id),
  description text,
  date date,
  recurring boolean DEFAULT false,
  recurring_interval text, -- daily, weekly, monthly, yearly
  external_source text, -- bank_api, manual, ghl, stripe
  external_id text, -- ID from external system
  created_at timestamp
)

ALTER TABLE finances ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can only see their own finances"
  ON finances FOR ALL
  USING (tenant_id = auth.uid());

-- FINANCE_GOALS
finance_goals (
  id uuid PRIMARY KEY,
  tenant_id uuid REFERENCES tenants(id) ON DELETE CASCADE,
  name text, -- "24k PLN/month", "Save for emergency fund"
  goal_type text, -- monthly_income, savings_target, debt_payoff
  target_amount decimal,
  current_amount decimal DEFAULT 0,
  currency text DEFAULT 'PLN',
  deadline date,
  status text, -- active, achieved, at_risk, cancelled
  created_at timestamp,
  updated_at timestamp
)

ALTER TABLE finance_goals ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can only see their own finance goals"
  ON finance_goals FOR ALL
  USING (tenant_id = auth.uid());

-- NOTIFICATIONS (Proactive alerts)
notifications (
  id uuid PRIMARY KEY,
  tenant_id uuid REFERENCES tenants(id) ON DELETE CASCADE,
  agent_id uuid REFERENCES agents(id),
  type text, -- reminder, alert, suggestion, deadline, insight
  priority integer, -- 1-4
  title text,
  message text,
  action_required boolean DEFAULT false,
  action_url text, -- deep link into app
  channel text, -- voice, sms, push, email, in_app
  scheduled_at timestamp,
  sent_at timestamp,
  acknowledged_at timestamp,
  status text, -- pending, sent, acknowledged, dismissed, failed
  created_at timestamp
)

ALTER TABLE notifications ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can only see their own notifications"
  ON notifications FOR ALL
  USING (tenant_id = auth.uid());

-- INDEXED_DOCUMENTS (Google Workspace + other sources)
indexed_documents (
  id uuid PRIMARY KEY,
  tenant_id uuid REFERENCES tenants(id) ON DELETE CASCADE,
  source text, -- gmail, drive, calendar, photos, local
  source_id text, -- Google resource ID or file path
  title text,
  content text,
  file_type text, -- email, doc, sheet, pdf, image, etc.
  embedding vector(1536),
  metadata jsonb, -- sender, date, labels, folder, etc.
  indexed_at timestamp,
  updated_at timestamp,
  UNIQUE(tenant_id, source, source_id)
)

ALTER TABLE indexed_documents ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can only see their own indexed documents"
  ON indexed_documents FOR ALL
  USING (tenant_id = auth.uid());

-- PATTERNS (System-learned behaviors)
patterns (
  id uuid PRIMARY KEY,
  tenant_id uuid REFERENCES tenants(id) ON DELETE CASCADE,
  pattern_type text, -- workflow, habit, trigger, blocker, success_factor
  name text,
  description text,
  frequency integer, -- how many times observed
  confidence decimal, -- 0.0-1.0
  impact_score decimal, -- positive or negative impact on goals
  context jsonb, -- when does this pattern occur
  learned_at timestamp,
  last_observed_at timestamp,
  active boolean DEFAULT true
)

ALTER TABLE patterns ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can only see their own patterns"
  ON patterns FOR ALL
  USING (tenant_id = auth.uid());

-- SYSTEM_OPTIMIZATIONS (Self-improvement log)
system_optimizations (
  id uuid PRIMARY KEY,
  tenant_id uuid REFERENCES tenants(id) ON DELETE CASCADE,
  optimization_type text, -- agent_weight_update, workflow_improvement, new_pattern_detected
  description text,
  before_state jsonb,
  after_state jsonb,
  expected_impact text,
  actual_impact decimal, -- measured after implementation
  applied_at timestamp,
  measured_at timestamp
)

ALTER TABLE system_optimizations ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can only see their own optimizations"
  ON system_optimizations FOR ALL
  USING (tenant_id = auth.uid());
```

---

## AGENT ECOSYSTEM (Modular Architecture)

### Core Agents (Everyone Gets These)

**Tier 1: Survival**
1. **System Coordinator** - routes requests, manages other agents
2. **Executive Assistant** - calendar, deadlines, reminders
3. **Task Manager** - task creation, tracking, completion

**Tier 2: Intelligence**
4. **Pattern Detective** - learns what works for you
5. **Gap Finder** - identifies missing structure
6. **Optimizer** - improves workflows over time

### Specialized Agents (User-Specific)

**Loaded based on user profile:**
- **ADHD Coach** - if user has ADHD diagnosis
- **Recovery Support** - if user in recovery
- **Financial Advisor** - if financial goals exist
- **Legal Assistant** - if legal cases tracked
- **Health Coach** - if health goals exist
- **Parent Planner** - if children in profile

### Learning Agents (Self-Improving)

These agents get **better over time** for each user:
- **Proactive Suggester** - learns when to interrupt vs stay quiet
- **Priority Ranker** - learns what's truly urgent for you
- **Energy Matcher** - learns which tasks fit which energy levels
- **Workflow Builder** - creates custom workflows based on patterns

### Custom Agents (User-Created)

Users can create their own agents:
- Define personality
- Set capabilities
- Assign to specific projects
- System learns from usage

---

## SELF-OPTIMIZATION MECHANISMS

### 1. Performance Tracking
Every agent interaction logs:
- Was task completed successfully?
- How long did it take?
- Did user follow through?
- User satisfaction (explicit or inferred)

### 2. Weight Adjustment
Agent weights in `tenant_agents.performance_weight`:
- Successful interaction → weight increases
- Failed interaction → weight decreases
- Higher weight = more likely to be selected

### 3. Pattern Learning
System observes:
- What time of day does user work best?
- Which agents are most useful?
- Which workflows lead to completion?
- What causes abandonment?

### 4. Automatic Workflow Creation
When system detects repeated patterns:
1. Identify sequence of actions
2. Propose automation
3. User approves
4. Add to workflow library

### 5. Agent Pruning
If agent has low performance for 30 days:
1. System suggests disabling
2. User can override
3. If disabled, resources freed for other agents

---

## INTEGRATION WITH EXISTING PROJECTS

### For Bogumił (Founder Account)

**lumpX.pro Integration:**
- Monitor product processing queue
- Alert when products stuck
- Track revenue per listing
- Suggest pricing optimizations

**IORS Integration:**
- Import contract performance data
- Sync therapeutic goals
- Track call metrics
- Measure user progress

**mouse_assistant Integration:**
- Log dictation vs typing ratio
- Track hands-free usage
- Measure productivity correlation

**General Project Visibility:**
- Dashboard: all projects at glance
- Next actions: what to do now
- Blockers: what's stuck and why
- Deadlines: what's coming up

---

## VOICE-FIRST INTERACTION PATTERNS

### Morning Check-in (Daily)
```
System: "Dzień dobry Bogumił. Energia 1-10?"
User: "Siódemka."
System: "Super. Masz dziś 3 deadlines: dokumenty sądowe (do piątku), VAPI credentials (dziś), i Boy Burger rozdział 2 (przyszły tydzień). Co robimy najpierw?"
User: "VAPI."
System: "Energia 7 wystarczy. Estimated 2 godziny. Masz blok wolny do 13:00. Zaczynamy?"
```

### Proactive Alerts
```
[Phone rings at 9:00 AM]
System: "Hej, System Optimizer. Zauważyłem że nie skończyłeś VAPI credentials wczoraj. Dzisiaj deadline. Blokuję Ci 2 godziny od 10:00 do 12:00. Potwierdzasz?"
User: "Tak, dobra."
System: "Wyłączam inne notyfikacje na ten czas. Powodzenia."
```

### Gap Detection
```
System: "Zauważyłem pattern: co tydzień zapominasz o dokumentach sądowych do czwartku wieczór. Chcesz żebym robił reminder w poniedziałki rano?"
User: "Tak, dobry pomysł."
System: "Ustawione. Będę dzwonił w poniedziałki o 9:00."
```

---

## SAAS BUSINESS MODEL

### Pricing Tiers

**Free Tier** (Lead Magnet)
- 1 user
- 3 core agents
- Voice: 30 min/month
- Basic task management
- 7-day data retention

**Basic** ($19/month)
- 1 user
- 10 agents (core + specialized)
- Voice: 300 min/month
- Full task + project management
- Google Workspace sync (basic)
- 30-day data retention

**Pro** ($49/month) ⭐ TARGET
- 1 user
- Unlimited agents
- Voice: unlimited
- All features
- Full integrations (GHL, Google, etc.)
- Semantic search
- Pattern learning
- 1-year data retention

**Enterprise** (Custom pricing)
- Multiple users
- Team agents (shared knowledge)
- Custom agents
- API access
- White-label option
- Unlimited retention

### Revenue Projections

**Year 1 Goals:**
- 100 free users (conversion funnel)
- 30 Basic ($19 × 30 = $570/mo)
- 15 Pro ($49 × 15 = $735/mo)
- **Total: ~$1,300/month ARR**

**Year 2 Goals:**
- 1,000 free users
- 200 Basic ($3,800/mo)
- 100 Pro ($4,900/mo)
- 5 Enterprise ($500/mo avg)
- **Total: ~$9,200/month ARR**

---

## MVP SCOPE (Phase 1)

### Must Have (Week 1-4)
- [ ] Supabase multi-tenant schema setup
- [ ] RLS policies (security)
- [ ] User registration + auth
- [ ] 5 core agents (Coordinator, EA, Task Manager, Pattern Detective, Gap Finder)
- [ ] Voice interface (VAPI + Polish TTS)
- [ ] Morning check-in flow
- [ ] Task capture (voice + web)
- [ ] Basic dashboard (projects, tasks, next actions)
- [ ] Google Calendar sync (read-only)

### Nice to Have (Week 5-8)
- [ ] Health tracking (energy, mood)
- [ ] Finance tracking (basic income/expense)
- [ ] Pattern learning (phase 1)
- [ ] Gmail indexing + semantic search
- [ ] Agent weight optimization (automatic)
- [ ] Mobile responsive UI
- [ ] Proactive notifications (voice calls)

### Future Phases
- [ ] Custom agent creation (UI)
- [ ] Workflow builder (visual)
- [ ] Team mode (multiple users)
- [ ] API for developers
- [ ] White-label deployment
- [ ] Mobile app (React Native)

---

## TECH STACK (Final)

**Voice Layer:**
- VAPI (orchestration)
- Azure TTS (Polish)
- Deepgram / Whisper (STT)

**AI Layer:**
- Claude API (reasoning + orchestration)
- OpenAI Embeddings (semantic search)

**Backend:**
- Supabase (PostgreSQL + Edge Functions + Realtime + Auth + Storage)
- pgvector (semantic search extension)

**Frontend:**
- Next.js 14 (App Router)
- shadcn/ui + Tailwind CSS
- React Query (data fetching)
- Zustand (state management)

**Integrations:**
- Google Workspace API (Drive, Gmail, Calendar, Photos)
- GoHighLevel API (CRM, automation)
- Twilio (SMS backup)

**DevOps:**
- VPS (Ubuntu + Docker)
- Nginx (reverse proxy)
- GitHub Actions (CI/CD)
- Vercel (frontend alternative)

**Monitoring:**
- Supabase logs
- Custom analytics dashboard
- Cost tracking per tenant

---

## NEXT STEPS

### Immediate Actions:
1. **Create Supabase project** - multi-tenant schema
2. **Enable pgvector extension** - semantic search
3. **VAPI account setup** - voice interface
4. **Google Workspace OAuth** - data access permissions
5. **Initial agent prompts** - core 5 agents
6. **Morning check-in flow** - voice script

### Questions to Answer:
1. **Name:** "Exoskull" final or still brainstorming?
2. **Domain:** exoskull.com / exoskull.ai / exoskull.pro?
3. **Launch timeline:** Soft launch for you (beta) in how many weeks?
4. **Public launch:** When to open for other users?
5. **Pricing:** Start with Free + Pro only, or all tiers from day 1?

---

**This is the full vision. Self-optimizing. Multi-tenant. Adaptive. Gap-filling.**

Ready to build?
